import {ParserError} from "./error/ParserError"
import {Token, PosInfo} from "./Tokenizer"
import {AstNode} from "./AstNode"
import {Rest} from "../haxe/extern/Rest"
import {EReg} from "../EReg"

export declare class ArrayInput<T> {
	constructor(array: T[])
	protected array: T[]
	protected _index: number
	protected index: number
	protected get_index(): number
	protected set_index(i: number): number
	next(): T
	skip(): void
	peek(): T
	hasNext(): boolean
	insert(token: T): void
	back(): void
	update(token: T): void
}

export type TokenInput = ArrayInput<Token>

export declare class Parser {
	static format(template: string, ...data: Rest<any>): string
	static toss(token: Token, error: string): void
	protected static unreachable(token: Token): ParserError
	protected static expect(reader: TokenInput, match: ((v: Token) => boolean)): void
	protected static expectThenData(reader: TokenInput, allowData?: boolean): null | string
	protected static block(reader: TokenInput, sub: (() => void), allowData?: boolean, onLastToken?: null | ((arg0: Token) => void)): null | string
	protected static readFunction(name: string, reader: TokenInput, pos: PosInfo): AstNode
	protected static innerParseTemplate(reader: TokenInput): AstNode
	protected static readTemplate(name: string, reader: TokenInput, pos: PosInfo): AstNode
	protected static pos(token: Token): PosInfo
	protected static json(reader: TokenInput): AstNode
	static parseMcbFile(tokens: Token[]): AstNode[]
	static parseMcbtFile(tokens: Token[]): AstNode[]
	protected static loopRegExp: EReg
	protected static executeRegExp: EReg
	static parserCompilerLoop(v: string, pos: PosInfo, reader: TokenInput, handler: (() => AstNode)): AstNode
	static parseTLD(reader: TokenInput): AstNode
	static readPlainJsonFile(v: string, pos: PosInfo, reader: TokenInput): AstNode
	static innerParse(reader: TokenInput): AstNode
	protected static readRaw(pos: PosInfo, v: string, reader: TokenInput, isMacro: boolean): AstNode
	protected static parseCompileTimeIf(v: string, pos: PosInfo, reader: TokenInput, arg: (() => AstNode)): AstNode
}
