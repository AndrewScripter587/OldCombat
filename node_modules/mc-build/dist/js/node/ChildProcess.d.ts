import {Buffer} from "buffer"

/**
Common options for all `ChildProcess` methods.
*/
export type ChildProcessCommonOptions = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
Common options for `spawn` and `spawnSync` methods.
*/
export type ChildProcessSpawnOptionsBase = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	Child's stdio configuration.
	*/
	stdio?: null | ChildProcessSpawnOptionsStdio, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
Options for the `spawn` method.
*/
export type ChildProcessSpawnOptions = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	The child will be a process group leader.
	*/
	detached?: null | boolean, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	Child's stdio configuration.
	*/
	stdio?: null | ChildProcessSpawnOptionsStdio, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
Options for the `spawnSync` method.
*/
export type ChildProcessSpawnSyncOptions = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	Default: 'utf8'
	*/
	encoding?: null | string, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	input?: null | string | Buffer, 
	/**
	The child process is killed with `killSignal` (default: 'SIGTERM').
	*/
	killSignal?: null | string, 
	/**
	The largest amount of data allowed on stdout or stderr.
	If this value is exceeded then the child process is killed.
	Default: 200*1024
	*/
	maxBuffer?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	Child's stdio configuration.
	*/
	stdio?: null | ChildProcessSpawnOptionsStdio, 
	/**
	If greater than 0, then it will kill the child process if it runs longer than timeout milliseconds.
	*/
	timeout?: null | number, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
The `stdio` option is an array where each index corresponds to a fd in the child.
The value is one of the following:

* 'pipe' - Create a pipe between the child process and the parent process.
The parent end of the pipe is exposed to the parent as a property on the child_process object as ChildProcess.stdio[fd].
Pipes created for fds 0 - 2 are also available as ChildProcess.stdin, ChildProcess.stdout and ChildProcess.stderr, respectively.

* 'ipc' - Create an IPC channel for passing messages/file descriptors between parent and child.
A ChildProcess may have at most one IPC stdio file descriptor. Setting this option enables the ChildProcess.send() method.
If the child writes JSON messages to this file descriptor, then this will trigger ChildProcess.on('message').
If the child is a Node.js program, then the presence of an IPC channel will enable process.send() and process.on('message').

* 'ignore' - Do not set this file descriptor in the child. Note that Node will always open fd 0 - 2 for the processes it spawns.
When any of these is ignored node will open /dev/null and attach it to the child's fd.

* Stream object - Share a readable or writable stream that refers to a tty, file, socket, or a pipe with the child process.
The stream's underlying file descriptor is duplicated in the child process to the fd that corresponds to the index
in the stdio array. Note that the stream must have an underlying descriptor (file streams do not until the 'open'
event has occurred).

* Positive integer - The integer value is interpreted as a file descriptor that is is currently open in the parent process.
It is shared with the child process, similar to how Stream objects can be shared.

* null - Use default value. For stdio fds 0, 1 and 2 (in other words, stdin, stdout, and stderr) a pipe is created.
For fd 3 and up, the default is 'ignore'.

As a shorthand, the stdio argument may also be one of the following strings, rather than an array:
ignore - ['ignore', 'ignore', 'ignore']
pipe - ['pipe', 'pipe', 'pipe']
inherit - [process.stdin, process.stdout, process.stderr] or [0,1,2]
*/
export type ChildProcessSpawnOptionsStdio = string | any[]

export type ChildProcessSpawnOptionsStdioFull = any[]

/**
Common options for `exec` and `execFile` methods.
*/
export type ChildProcessExecOptionsBase = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	Default: 'utf8'
	*/
	encoding?: null | string, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	/**
	The child process is killed with `killSignal` (default: 'SIGTERM').
	*/
	killSignal?: null | string, 
	/**
	The largest amount of data allowed on stdout or stderr.
	If this value is exceeded then the child process is killed.
	Default: 200*1024
	*/
	maxBuffer?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	If greater than 0, then it will kill the child process if it runs longer than timeout milliseconds.
	*/
	timeout?: null | number, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
Options for the `exec` method.
*/
export type ChildProcessExecOptions = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	Default: 'utf8'
	*/
	encoding?: null | string, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	/**
	The child process is killed with `killSignal` (default: 'SIGTERM').
	*/
	killSignal?: null | string, 
	/**
	The largest amount of data allowed on stdout or stderr.
	If this value is exceeded then the child process is killed.
	Default: 200*1024
	*/
	maxBuffer?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	If greater than 0, then it will kill the child process if it runs longer than timeout milliseconds.
	*/
	timeout?: null | number, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
Options for the `execFile` method.
*/
export type ChildProcessExecFileOptions = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	Default: 'utf8'
	*/
	encoding?: null | string, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	/**
	The child process is killed with `killSignal` (default: 'SIGTERM').
	*/
	killSignal?: null | string, 
	/**
	The largest amount of data allowed on stdout or stderr.
	If this value is exceeded then the child process is killed.
	Default: 200*1024
	*/
	maxBuffer?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	If greater than 0, then it will kill the child process if it runs longer than timeout milliseconds.
	*/
	timeout?: null | number, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
Options for the `fork` method.
*/
export type ChildProcessForkOptions = {
	/**
	Current working directory of the child process.
	*/
	cwd?: null | string, 
	/**
	Environment key-value pairs
	*/
	env?: null | {[key: string]: string}, 
	/**
	List of string arguments passed to the executable (Default: process.execArgv)
	*/
	execArgv?: null | string[], 
	/**
	Executable used to create the child process
	*/
	execPath?: null | string, 
	/**
	Sets the group identity of the process. See setgid(2).
	*/
	gid?: null | number, 
	/**
	Shell to execute the command with.
	Default: '/bin/sh' on UNIX, 'cmd.exe' on Windows.
	
	The shell should understand the -c switch on UNIX or /s /c on Windows.
	On Windows, command line parsing should be compatible with cmd.exe.
	*/
	shell?: null | boolean | string, 
	/**
	If `true`, stdin, stdout, and stderr of the child will be piped to the parent,
	otherwise they will be inherited from the parent, see the "pipe" and "inherit"
	options for `ChildProcessSpawnOptions.stdio` for more details (default is `false`)
	*/
	silent?: null | boolean, 
	/**
	Sets the user identity of the process. See setuid(2).
	*/
	uid?: null | number
}

/**
A callback type for `ChildProcess.exec`.
It receives three arguments: `error`, `stdout`, `stderr`.

On success, error will be `null`. On error, `error` will be an instance of `Error`
and `error.code` will be the exit code of the child process, and `error.signal` will be set
to the signal that terminated the process (see `ChildProcessExecError`).
*/
export type ChildProcessExecCallback = ((error: null | Error, stdout: Buffer | string, stderr: Buffer | string) => void)

/**
Object returned from the `spawnSync` method.
*/
export type ChildProcessSpawnSyncResult = {
	/**
	The error object if the child process failed or timed out
	*/
	error: Error, 
	/**
	Array of results from stdio output
	*/
	output: Buffer | string[], 
	/**
	Pid of the child process
	*/
	pid: number, 
	/**
	The signal used to kill the child process
	*/
	signal: string, 
	/**
	The exit code of the child process
	*/
	status: number, 
	/**
	The contents of output[2]
	*/
	stderr: Buffer | string, 
	/**
	The contents of output[1]
	*/
	stdout: Buffer | string
}
